# 📊 Web 管理面板使用指南

## 🌟 功能特性

AuthAnvilLogin v2.3.0 新增了现代化的 Web 管理面板，提供实时统计数据可视化和安全监控功能。

### ✨ 主要功能

- **实时统计数据** - 今日注册、登录、失败次数等关键指标
- **历史趋势图表** - 使用 Chart.js 展示最近 7-30 天的数据趋势
- **玩家排行榜** - TOP 10 登录次数排行，包含详细统计信息
- **安全事件监控** - 实时查看最近的登录、注册、失败、速率限制等事件
- **自动刷新** - 每 5 秒自动更新数据，无需手动刷新
- **响应式设计** - 支持桌面和移动设备访问
- **令牌认证** - 安全的访问控制机制

---

## 🚀 快速开始

### 1. 配置文件设置

编辑 `plugins/AuthAnvilLogin/config.yml`：

```yaml
# Web 管理面板配置
web:
  enabled: true        # 是否启用 Web 管理面板
  port: 8080          # Web 服务器端口
  token: ""           # 访问令牌（留空自动生成）
```

**配置说明：**
- `enabled`: 设置为 `true` 启用面板，`false` 禁用
- `port`: Web 服务器监听端口（默认 8080）
- `token`: 访问令牌，留空则自动生成 32 位随机令牌

### 2. 启动服务器

重启 Minecraft 服务器或使用 `/al reload` 重载配置。

服务器启动后，控制台会显示：

```
========================================
Web 管理面板已启动！
访问地址: http://localhost:8080
访问令牌: AbCdEf1234567890...
使用命令 /al stats 查看详情
========================================
```

### 3. 访问面板

#### 方法 1：游戏内命令
```
/al stats
```
会显示访问地址和令牌信息。

#### 方法 2：直接访问
在浏览器中打开：`http://localhost:8080`

### 4. 输入令牌

首次访问会看到认证页面，输入控制台显示的访问令牌即可进入。

令牌会保存在浏览器本地存储中，下次访问无需重新输入。

---

## 📊 面板功能详解

### 总览页面

显示核心统计数据：

- **今日注册** - 今天新注册的玩家数量
- **今日登录** - 今天成功登录的次数
- **今日失败** - 今天登录失败的次数
- **速率限制** - 今天触发速率限制的次数
- **总玩家数** - 已注册的玩家总数
- **平均登录时长** - 玩家平均登录耗时（毫秒）
- **登录成功率** - 总体登录成功率百分比

### 历史趋势图表

使用 Chart.js 绘制的折线图，展示：
- 最近 7 天的注册、登录、失败趋势
- 支持鼠标悬停查看详细数据
- 自动适应屏幕大小

### 玩家排行榜

显示登录次数 TOP 10 的玩家：
- 🥇🥈🥉 前三名特殊标记
- 总登录次数
- 失败尝试次数
- 最后登录时间
- 最后登录 IP

### 安全事件

实时显示最近 20 条安全事件：
- ✅ **登录成功** - 绿色标记
- ❌ **登录失败** - 红色标记
- 📝 **账号注册** - 蓝色标记
- ⚠️ **速率限制** - 橙色标记
- 🔒 **账户锁定** - 黑色标记

每条事件包含：玩家名、IP 地址、时间戳、详细信息

---

## 🔒 安全建议

### 1. 修改默认端口

如果 8080 端口已被占用或需要更高安全性：

```yaml
web:
  port: 9999  # 使用其他端口
```

### 2. 自定义访问令牌

不使用自动生成的令牌，手动设置强密码：

```yaml
web:
  token: "YourVerySecureToken123!@#"
```

### 3. 防火墙配置

**重要：** 默认情况下，Web 面板只监听 `localhost`，仅本机可访问。

如需远程访问，请：
1. 配置防火墙规则，只允许信任的 IP 访问
2. 考虑使用反向代理（如 Nginx）添加 HTTPS 支持
3. 定期更换访问令牌

### 4. 禁用面板

如果不需要 Web 面板功能：

```yaml
web:
  enabled: false
```

---

## 🛠️ 故障排查

### 问题 1：无法访问面板

**症状：** 浏览器显示"无法连接"

**解决方案：**
1. 检查配置文件中 `web.enabled` 是否为 `true`
2. 确认端口未被其他程序占用
3. 查看服务器控制台是否有错误信息
4. 尝试使用 `127.0.0.1:8080` 而不是 `localhost:8080`

### 问题 2：令牌无效

**症状：** 输入令牌后提示"Unauthorized"

**解决方案：**
1. 确保输入的令牌与控制台显示的完全一致（区分大小写）
2. 使用 `/al stats` 命令重新查看令牌
3. 清除浏览器缓存和 localStorage
4. 重启服务器重新生成令牌

### 问题 3：数据不更新

**症状：** 面板显示的数据是旧的

**解决方案：**
1. 等待 5 秒，面板会自动刷新
2. 手动刷新浏览器页面（F5）
3. 检查服务器是否正常运行
4. 查看浏览器控制台是否有 JavaScript 错误

### 问题 4：端口冲突

**症状：** 控制台显示"Address already in use"

**解决方案：**
1. 修改配置文件中的端口号
2. 或者停止占用该端口的其他程序

---

## 🎨 技术栈

### 后端
- **NanoHTTPD** - 轻量级 HTTP 服务器
- **Gson** - JSON 序列化/反序列化
- **Java 21** - 现代化 Java 特性

### 前端
- **原生 HTML/CSS/JavaScript** - 无框架依赖
- **Chart.js 4.4.0** - 数据可视化图表库
- **现代 CSS** - 渐变、阴影、动画效果
- **响应式设计** - 适配各种屏幕尺寸

### 特性
- **异步数据加载** - 不阻塞主线程
- **自动刷新机制** - 实时数据更新
- **本地存储** - 令牌持久化
- **RESTful API** - 标准化接口设计

---

## 📡 API 端点

如需自定义开发，可以使用以下 API 端点：

### GET /api/stats
获取统计数据概览

**请求头：**
```
Authorization: Bearer {your_token}
```

**响应示例：**
```json
{
  "today": {
    "registrations": 5,
    "logins": 120,
    "failures": 8,
    "rateLimits": 2
  },
  "total": {
    "registrations": 1500,
    "logins": 45000,
    "failures": 320,
    "players": 1500
  },
  "averageLoginTime": 85,
  "successRate": 99.3
}
```

### GET /api/history
获取历史数据（最近 30 天）

### GET /api/players
获取玩家排行榜

### GET /api/events
获取最近安全事件

---

## 🔄 更新日志

### v2.3.0 (2025-02-12)

**🎨 新功能**
- ✨ 新增 Web 管理面板
  - 实时统计数据展示
  - 历史趋势图表
  - 玩家排行榜
  - 安全事件监控
- ✨ 新增统计数据持久化（JSON 格式）
- ✨ 新增 `/al stats` 命令查看面板信息

**🔧 优化改进**
- ⚡ 统计数据异步收集，不影响游戏性能
- ⚡ 自动清理 30 天前的历史数据
- 🛡️ 令牌认证机制保护面板安全

---

## 💡 使用建议

1. **定期查看统计** - 了解服务器登录情况和安全状态
2. **关注失败率** - 如果失败率突然升高，可能有人在尝试暴力破解
3. **监控速率限制** - 频繁触发可能表示有恶意行为
4. **分析登录趋势** - 了解玩家活跃时间段
5. **备份统计数据** - `plugins/AuthAnvilLogin/statistics.json` 包含所有统计数据

---

## 📞 支持与反馈

如有问题或建议，请：
- 提交 Issue: https://github.com/ian171/AuthAnvilLogin/issues
- 查看文档: https://github.com/ian171/AuthAnvilLogin

---

**Made with ❤️ by AuthAnvilLogin Team**
